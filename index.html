<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uktics Demo</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: auto; }
        .panel { border: 1px solid #ccc; padding: 20px; margin-bottom: 20px; border-radius: 5px; }
        .hidden { display: none; }
        .dark { background-color: #333; color: #fff; }
        .light { background-color: #fff; color: #000; }
        .button { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; }
        .toast { position: fixed; bottom: 20px; right: 20px; background: #28a745; color: white; padding: 10px; border-radius: 5px; }
        .run-history { margin-top: 20px; }
        .run { padding: 10px; border: 1px solid #ccc; margin: 5px 0; cursor: pointer; }
        .run.executing { animation: pulse 1s infinite; }
        @keyframes pulse { 0% { background-color: #f0f0f0; } 50% { background-color: #e0e0e0; } 100% { background-color: #f0f0f0; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>Uktics Demo</h1>
        <div class="panel">
            <h2>Start AutoFix</h2>
            <form id="autofix-form">
                <label for="repo">Repo (owner/repo):</label>
                <input type="text" id="repo" required>
                <label for="branch">Branch:</label>
                <input type="text" id="branch" required>
                <label for="prompt">Prompt:</label>
                <textarea id="prompt" required></textarea>
                <label for="merge-method">Merge Method:</label>
                <select id="merge-method">
                    <option value="merge">Merge</option>
                    <option value="squash">Squash</option>
                </select>
                <label><input type="checkbox" id="auto-merge"> Auto-merge</label>
                <label><input type="checkbox" id="delete-branch"> Delete branch</label>
                <button type="submit" class="button">Submit</button>
            </form>
            <div id="toast" class="toast hidden">Demo: Run queued</div>
        </div>
        <div class="panel run-history">
            <h2>Run History</h2>
            <input type="text" id="search-repo" placeholder="Search by repo">
            <div id="filter-chips">
                <button class="button" data-filter="all">All</button>
                <button class="button" data-filter="success">Success</button>
                <button class="button" data-filter="failed">Failed</button>
                <button class="button" data-filter="running">Running</button>
            </div>
            <div id="runs"></div>
        </div>
    </div>
    <script>
        const form = document.getElementById('autofix-form');
        const toast = document.getElementById('toast');
        const runsDiv = document.getElementById('runs');
        const searchRepo = document.getElementById('search-repo');
        const filterButtons = document.querySelectorAll('#filter-chips .button');
        let runs = [
            { id: 1, repo: 'owner/repo1', status: 'PR_OPENED' },
            { id: 2, repo: 'owner/repo2', status: 'EXECUTING' },
            { id: 3, repo: 'owner/repo3', status: 'FAILED' },
            { id: 4, repo: 'owner/repo4', status: 'MERGED' },
            { id: 5, repo: 'owner/repo5', status: 'EXECUTING' },
            { id: 6, repo: 'owner/repo6', status: 'PR_OPENED' },
            { id: 7, repo: 'owner/repo7', status: 'FAILED' },
            { id: 8, repo: 'owner/repo8', status: 'MERGED' }
        ];
        let currentFilter = 'all';

        function renderRuns() {
            runsDiv.innerHTML = '';
            const filteredRuns = runs.filter(run => {
                if (currentFilter === 'all') return true;
                return run.status.toLowerCase() === currentFilter;
            });
            filteredRuns.forEach(run => {
                const runDiv = document.createElement('div');
                runDiv.className = 'run ' + (run.status === 'EXECUTING' ? 'executing' : '');
                runDiv.innerText = `${run.repo} - ${run.status}`;
                runDiv.onclick = () => openModal(run);
                runsDiv.appendChild(runDiv);
            });
        }

        function openModal(run) {
            alert(`Run Details: ${JSON.stringify(run)}`);
        }

        form.onsubmit = function(event) {
            event.preventDefault();
            const repo = document.getElementById('repo').value;
            const branch = document.getElementById('branch').value;
            const prompt = document.getElementById('prompt').value;
            if (!/^[A-Za-z0-9_.-]+/[A-Za-z0-9_.-]+$/.test(repo)) {
                alert('Invalid repo format.');
                return;
            }
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
            runs.push({ id: runs.length + 1, repo: repo, status: 'EXECUTING' });
            renderRuns();
        };

        searchRepo.oninput = function() {
            const searchTerm = searchRepo.value.toLowerCase();
            runsDiv.innerHTML = '';
            runs.filter(run => run.repo.toLowerCase().includes(searchTerm)).forEach(run => {
                const runDiv = document.createElement('div');
                runDiv.className = 'run ' + (run.status === 'EXECUTING' ? 'executing' : '');
                runDiv.innerText = `${run.repo} - ${run.status}`;
                runDiv.onclick = () => openModal(run);
                runsDiv.appendChild(runDiv);
            });
        };

        filterButtons.forEach(button => {
            button.onclick = function() {
                currentFilter = this.getAttribute('data-filter');
                renderRuns();
            };
        });

        function setTheme(theme) {
            document.body.className = theme;
            localStorage.setItem('theme', theme);
        }

        function toggleTheme() {
            const currentTheme = localStorage.getItem('theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            setTheme(newTheme);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            setTheme(savedTheme);
        });
    </script>
</body>
</html>